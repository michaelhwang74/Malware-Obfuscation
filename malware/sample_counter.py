import os
import re

def getAllFiles(path):
    files = []
    for r, d, f in os.walk(path):
        for file in f:
            if file.endswith('.txt'):
                files.append(os.path.join(r, file))
    return files

def count_file(file_name):
    freq = {}
    file = open(file_name, 'r')
    for line in file.readlines():
        string = re.sub('[^a-z]', '', line.lower())#remove all non alpha characters
        if string in freq.keys():
            freq[string] = freq[string]+1
        else:
            freq[string] = 1
    file.close()
    return freq

def merg_dict(dict1, dict2):

    for key in dict2.keys():
        if key in dict1.keys():
            dict1[key] = dict1[key] + dict2[key]
        else:
            dict1[key] = dict2[key]
    return dict1

def countAllFiles(files):
    freqs = {}
    for file_name in files:
        merg_dict(freqs, count_file(file_name))
    return freqs

def saveFrequencies(freqs, save_name, limit):
    sorted_freq = dict(sorted(freqs.items(), key=lambda x: x[1], reverse=True))
    save_file = open(save_name, 'w')
    for key in sorted_freq.keys():
        if sorted_freq[key] < limit:
            break
        save_file.write(f'{key} {sorted_freq[key]}\n')
    save_file.close()

folder = './samples/original'
samples = getAllFiles(folder)
saveFrequencies(countAllFiles(samples), './frequencies.txt', 30)