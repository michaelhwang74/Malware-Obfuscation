import re

def isExcluded(line):
    if(re.match("^[\\s]+$|^$|^_.+$", line)):
        return True
    if(re.search('=|\\?|db|dd|dq|dw|UNWIND_CODE|xmmword|text|<|>|align|struc|ends|assume|union|:|\\.', line)):
        return True
    return False

def removeNonStandard(s): 
    return "".join(i for i in s if ord(i)<128)

def stripFile(fileName, saveDirectory = './'):
    file = open(f"./{fileName}.asm", encoding='utf-8')
    output = open(f"{saveDirectory}{fileName}Stripped.txt", 'w')
    for line in file:
        line = re.sub('^\\s+', '', removeNonStandard(line)) #remove starting indents
        line = re.sub('(;.*)|[\\t\\n\\r\\f\\v]+', '', line) #replace non-space whitespace characters and comments
        line = re.sub('\\s+', ' ', line) #replace multi white space with single
        if(not isExcluded(line)):
            output.write(line + "\n")
    file.close()
    output.close()